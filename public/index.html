<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To do list</title>
    <link rel="shortcut icon" href="https://www.flaticon.com/svg/static/icons/svg/1617/1617614.svg" type="image/x-icon" >

    <link rel="stylesheet" type="text/css" href="stylesheets/todo.css">
  </head>

<body onload="loadList()">

<h1>To do</h1>

<ol id="list">

</ol>

<button id="addItem" onclick="addItem()">Create a new todo item</button>
<form id="todo" method="GET" action="/update">
  
  <table class="hidden" id="addForm">
    <tr><td>To do item</td><td><input type="text" name="item"></td></tr>
    <tr><td>Item priority</td><td class="hint"><input type="number" name="priority" min="1" max="3">1 = high, 3 = low</td></tr>
    <tr><td colspan="2"><input type="submit" value="Update list" ><input type="button" onclick="cancel()" value="Cancel"></td></tr>
  </table>
</form>

<button id="deleteItem" onclick="del()">Delete an item</button>
<form class="hidden" id="del" method="GET" action="/delete">
  <ol id="delList">
  </ol>
  <input type="submit" value="Delete Item" >
  <input type="button" onclick="cancel()" value="Cancel">
</form>

<script>
  function loadList() { 
    var xmlHttpRequest = new XMLHttpRequest();
    xmlHttpRequest.onreadystatechange = function() { 
      if (xmlHttpRequest.readyState == XMLHttpRequest.DONE && xmlHttpRequest.status == 200 ) {
        console.log('getting database request');

        var database = JSON.parse(xmlHttpRequest.responseText);
        // console.log(database);
        var list = document.getElementById('list');

        for (var i = 0; i < database.todo.length + 1; i++) { 
          var item = document.createElement('li');
          if (i < database.todo.length - 1) {
            if (database.todo[i].priority < database.todo[i + 1].priority) { 
            item.innerHTML = database.todo[i].item + "<br><br>"
            } else {
            item.innerHTML = database.todo[i].item;
            }
          } else {
            item.innerHTML = database.todo[i].item;
          }
          list.appendChild(item);
        }

      }
    }
    xmlHttpRequest.open('GET', 'https://nates-notes.herokuapp.com/todo', true);
    xmlHttpRequest.send();
  };

  function addItem() { 
    document.getElementById('addForm').style.display = "initial";
    document.getElementById('addItem').style.display = "none";
  };

  function cancel() { 
    document.getElementById('addForm').style.display = "none";
    document.getElementById('del').style.display = "none";
    document.getElementById('addItem').style.display = "initial";
    document.getElementById('list').style.display = "revert";
    document.getElementById('deleteItem').style.display = "revert";
  }

  function del() { 
    document.getElementById('del').style.display = "initial";
    var list    = document.getElementById('list');
    var dList = document.getElementById('delList');

    if (dList.childElementCount < 1) {
      for (var i = 0; i < list.childElementCount; i++) {
        var op = document.createElement('input');
        var label = document.createElement('label');
        op.setAttribute("type", "radio");
        op.setAttribute("name", "item");
        op.setAttribute("id", list.childNodes[i+1].innerText);
        dList.appendChild(op);
        op.setAttribute("value", list.childNodes[i+1].innerText);
        dList.appendChild(op);
        label.innerHTML = list.childNodes[i+1].innerText + "<br>";
        label.setAttribute("for", list.childNodes[i+1].innerText);
        dList.appendChild(label);
      }
    }
    document.getElementById('list').style.display = "none";
    document.getElementById('deleteItem').style.display = "none";
  }
</script>


</body>
</html>